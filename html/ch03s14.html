<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>14.&nbsp;HTML helper service</title><link rel="stylesheet" type="text/css" href="html.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Joomla Extensions Development"><link rel="up" href="ch03.html" title="Chapter&nbsp;3.&nbsp;Components"><link rel="prev" href="ch03s13.html" title="13.&nbsp;Tables"><link rel="next" href="ch03s15.html" title="15.&nbsp;Categories"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">14.&nbsp;HTML helper service</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s13.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Components</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch03s15.html"><img src="images/next.svg" alt="Next"></a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="com-html"></a>14.&nbsp;HTML helper service</h2></div></div></div><p>Joomla has long provided a mechanism for creating your own HTML helper classes. These are meant to provide relatively short methods which return HTML snippets based on data which requires more than a line or two of PHP code to be processed and/or is called frequently enough throughout your component that it makes no sense having to the same thing over and over again. For example, you could have methods which return item associations, format dates, load a layout for presenting user information in backend grid views etc.</p><p>Joomla 4 continues to offer this possibility and further enhances it. Your key take-aways are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>Joomla 4 HTML helpers are services registered through your extension class</strong></span> instead of pure static classes which had to be registered with <code class="code">\Joomla\CMS\HTML\HTMLHelper::addIncludePath</code>.</p></li><li class="listitem"><p><span class="bold"><strong>Joomla 4 HTML helpers have non-static methods</strong></span> whereas Joomla 3 HTML helpers had static methods.</p></li><li class="listitem"><p><span class="bold"><strong>In Joomla 4 you can register whichever prefix you want</strong></span>, not necessarily the same as the name of the class(es) providing your HTML helper service(s).</p></li><li class="listitem"><p><span class="bold"><strong>You still call your HTML helpers through the <code class="code">\Joomla\CMS\HTML\HTMLHelper::_()</code> method</strong></span>.</p></li></ul></div><h3><a name="d0e3997"></a>How we did things in Joomla 3</h3><p>Back in Joomla 3 we'd create a class file in our <code class="filename">helpers/html</code> folder, e.g. <code class="filename">administrator/components/helpers/html/example.php</code>. It would contain a pure static class with a name starting with <code class="code">JHtml</code>, e.g <code class="code">JHtmlExample</code>. Here's a trivial example:</p><pre class="programlisting">&lt;?php

class JHtmlExample {
  public static function hello($who) {
    $who = htmlspecialchars($who);
    return "&lt;p&gt;Hello, {$who}!&lt;/p&gt;";
  }
}</pre><p>Within our component the helper was automatically registered and we could use it like this:</p><pre class="programlisting">&lt;?php echo \Joomla\CMS\HTML\HTMLHelper::_('example.hello', 'world') ?&gt;</pre><p>This would result in</p><pre class="screen">&lt;p&gt;Hello, world!&lt;/p&gt;</pre><p>Outside our component we'd have to remember to register this helper manually:</p><pre class="programlisting">\Joomla\CMS\HTML\HTMLHelper::addIncludePath(JPATH_ADMINISTRATOR . 
  '/components/com_example/helpers/html');</pre><p>When we forgot to do that, e.g. in a module of ours? Hilarity ensued&#8230;</p><p>This approach also had other problems. What if there are two helpers, one of ours and one of another component, using the same class name? PHP Fatal Error! What happens if we use a name for our helper which &#8220;shades&#8221; a name used by Joomla itself? We break things! What happens if the service we need to use is not available as a static method? Ugly workarounds! Generally speaking, it was a bad idea but, like most things in older versions of Joomla, was better than nothing which made it good enough.</p><h3><a name="d0e4031"></a>The way to do it in Joomla 4</h3><p>In Joomla 4 we will create a <span class="emphasis"><em>service</em></span>. It sounds big and scary but... let me tell you a secret. We are just going to create a regular PHP class. It does not extend from anything, it does not have any special requirements. That's right, we are writing the simplest possible PHP class.</p><pre class="programlisting">&lt;?php
namespace Acme\Example\Administrator\Service\Html;

class Example {
  public function hello($who) {
    $who = htmlspecialchars($who);
    return "&lt;p&gt;Hello, {$who}!&lt;/p&gt;";
  }
}</pre><p>Now we can instantiate it in our component's extension class's boot method.</p><pre class="programlisting">&lt;?php
namespace Acme\Example\Administrator\Extension;

class Example extends MVCComponent implements BootableExtensionInterface {
	public function boot(ContainerInterface $container)
	{
		$this-&gt;getRegistry()-&gt;register('ats', new ATS());
	}  
}</pre><h3><a name="d0e4044"></a>Pushing services</h3><p>In the Joomla 3 paradigm the HTML helper class was static, meaning that any services it needs would have to be fetched with static or otherwise global calls as well. For example, getting the database driver object would require doing <code class="code">\Joomla\CMS\Factory::getDbo()</code>. In Joomla 4 this kind of static calls is deprecated. So, how do you do it?</p><p>The trick is that you can push services using the HTML helper class's constructor. For example, pushing the database:</p><pre class="programlisting">&lt;?php
namespace Acme\Example\Administrator\Service\Html;

class Example {
  <span class="bold"><strong>private $db;</strong></span>

  <span class="bold"><strong>public function __construct(\Joomla\Database\DatabaseDriver $dn) {
    $this-&gt;db = $db;
  }</strong></span>

  public function hello($who) {
    $who = htmlspecialchars($who);
    return "&lt;p&gt;Hello, {$who}!&lt;/p&gt;";
  }
}</pre><p>We also need to change the initialisation of our HTML service:</p><pre class="programlisting">&lt;?php
namespace Acme\Example\Administrator\Extension;

class Example extends MVCComponent implements BootableExtensionInterface {
	public function boot(ContainerInterface $container)
	{
		<span class="bold"><strong>$db = $container-&gt;get('DatabaseDriver');</strong></span>
		$this-&gt;getRegistry()-&gt;register('ats', new ATS(<span class="bold"><strong>$db</strong></span>));
	}  
}</pre><p>You can push any service, including your component's MVCFactory service which means that you can get instances of any Model of your component to retrieve database data in your HTML helper. Or, maybe, Joomla's UserFactory service so you can create instances of any user given their ID or username to get and present information about them. You get the idea!</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s13.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch03.html"><img src="images/up.svg" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch03s15.html"><img src="images/next.svg" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">13.&nbsp;Tables&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.svg" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;15.&nbsp;Categories</td></tr></table></div></body></html>