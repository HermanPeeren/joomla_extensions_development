<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>7.&nbsp;Dispatcher</title><link rel="stylesheet" type="text/css" href="html.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Joomla Extensions Development"><link rel="up" href="ch03.html" title="Chapter&nbsp;3.&nbsp;Components"><link rel="prev" href="ch03s06.html" title="6.&nbsp;Extension class"><link rel="next" href="ch03s08.html" title="8.&nbsp;Namespaces and MVC"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">7.&nbsp;Dispatcher</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s06.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Components</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch03s08.html"><img src="images/next.svg" alt="Next"></a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="com-dispatcher"></a>7.&nbsp;Dispatcher</h2></div></div></div><p>As we said <a class="link" href="ch03s02.html" title="2.&nbsp;Joomla 3 MVC vs Joomla 4 MVC">when comparing the Joomla 3 to the Joomla 4 MVC</a>, the Dispatcher takes the place of the front controller (<code class="filename">controller.php</code>) in the legacy Joomla 3 MVC. In some ways it also takes the place of the entry point file (e.g. <code class="filename">example.php</code> for a component named <code class="code">com_example</code>) as it's the first code which is executed when our component is loaded with the explicit intent of rendering output.</p><p>Most components do not need a custom Dispatcher. The default Dispatcher provided by Joomla is just fine.</p><p>If you do decide to create a custom Dispatcher its class name <span class="bold"><strong>MUST</strong></span> be <code class="code"><em class="replaceable"><code>\My\Prefix</code></em>\Administrator\Dispatcher\Dispatcher</code> (backend), <code class="code"><em class="replaceable"><code>\My\Prefix</code></em>\Site\Dispatcher\Dispatcher</code> (frontend) or <code class="code"><em class="replaceable"><code>\My\Prefix</code></em>\Api\Dispatcher\Dispatcher</code> (API application) where <code class="code">\My\Prefix</code> is the namespace prefix for your component. This class must extend from <code class="code">\Joomla\CMS\Dispatcher\ComponentDispatcher</code>.</p><p>Typically, there are two methods you might need to customise. One is <code class="code">loadLanguage</code> which loads your component's language files. You may have to customise that if, for example, you need to load the backend files in the frontend or vice versa, or if you need to load some core component's language files on top of yours.</p><p>The other method may be the <code class="code">dispatch()</code> method which figures out the view, task and controller from the input and executes the component.</p><p>Usually, I override the <code class="code">dispatch()</code> method to add a minimum PHP version check and fix up the request variables so I always have a view and task. The latter helps when writing Routers for components which have record add / edit views in the <span class="emphasis"><em>frontend</em></span>. Such a Dispatcher would look like the following code example.</p><pre class="programlisting">&lt;?php
namespace Acme\Example\Site\Dispatcher;

defined('_JEXEC') or die;

class Dispatcher extends \Joomla\CMS\Dispatcher\ComponentDispatcher
{
	/**
	 * The default controller (and view), if none is specified in the request.
	 *
	 * @var   string
	 */
	protected $defaultController = 'items';

	/** @inheritdoc */
	public function dispatch()
	{
		$minPHPVersion = '7.4.0';

		if (version_compare(PHP_VERSION, $minPHPVersion, 'lt'))
		{
			throw new \RuntimeException(
				sprintf(
					'This component requires PHP %s or later.',
					$minPHPVersion
				)
			);
		}

		$this-&gt;applyViewAndController();
		
		parent::dispatch();
	}

	/**
	 * Applies the view and controller to the input object communicated to the MVC objects.
	 *
	 * If we have a controller without view or just a task=controllerName.taskName we populate the view to make things
	 * easier and more consistent for us to handle.
	 *
	 * @return  void
	 */
	protected function applyViewAndController(): void
	{
		$controller = $this-&gt;input-&gt;getCmd('controller', null);
		$view       = $this-&gt;input-&gt;getCmd('view', null);
		$task       = $this-&gt;input-&gt;getCmd('task', 'default');

		if (strpos($task, '.') !== false)
		{
			// Explode the controller.task command.
			[$controller, $task] = explode('.', $task);
			$view = null;
		}

		if (empty($controller) &amp;&amp; empty($view))
		{
			$controller = $this-&gt;defaultController;
			$view       = $this-&gt;defaultController;
		}
		elseif (empty($controller) &amp;&amp; !empty($view))
		{
			$controller = $view;
		}
		elseif (!empty($controller) &amp;&amp; empty($view))
		{
			$view = $controller;
		}

		$controller = strtolower($controller);
		$view       = strtolower($view);

		$this-&gt;input-&gt;set('view', $view);
		$this-&gt;input-&gt;set('controller', $controller);
		$this-&gt;input-&gt;set('task', $task);
	}
}</pre></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s06.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch03.html"><img src="images/up.svg" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch03s08.html"><img src="images/next.svg" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">6.&nbsp;Extension class&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.svg" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;8.&nbsp;Namespaces and MVC</td></tr></table></div></body></html>