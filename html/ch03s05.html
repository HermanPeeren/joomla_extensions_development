<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>5.&nbsp;Service provider</title><link rel="stylesheet" type="text/css" href="html.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Joomla Extensions Development"><link rel="up" href="ch03.html" title="Chapter&nbsp;3.&nbsp;Components"><link rel="prev" href="ch03s04.html" title="4.&nbsp;Directory structure"><link rel="next" href="ch03s06.html" title="6.&nbsp;Extension class"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">5.&nbsp;Service provider</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s04.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Components</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch03s06.html"><img src="images/next.svg" alt="Next"></a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="com-services"></a>5.&nbsp;Service provider</h2></div></div></div><p>As discussed in the previous section, the service provider file is mandatory for Joomla 4 MVC components and lives in the component's <code class="filename">services</code> folder and always named <code class="filename">provider.php</code>.</p><p>The absolutely minimal minimal service provider file looks like the following:</p><pre class="programlisting">&lt;?php
defined('_JEXEC') || die;

use Acme\Example\Administrator\Extension\ExampleComponent;
use Joomla\CMS\Dispatcher\ComponentDispatcherFactoryInterface;
use Joomla\CMS\Extension\ComponentInterface;
use Joomla\CMS\Extension\Service\Provider\MVCFactory;
use Joomla\CMS\MVC\Factory\MVCFactoryInterface;
use Joomla\DI\Container;
use Joomla\DI\ServiceProviderInterface;

return new class implements ServiceProviderInterface {
	public function register(Container $container)
	{
		// PART 1: Register service providers to the component's container
		$container-&gt;registerServiceProvider(new MVCFactory('Acme\\Example'));

		// PART 2: Instantiate and set up your extension object
		$container-&gt;set(
			ComponentInterface::class,
			function (Container $container) {
				/**
				 * PART 2.a: Instantiate the extension object
				 *
				 * If you do not have a custom extension class use \Joomla\CMS\Extension\MVCComponent instead.
				 */
				$component = new \Acme\Example\Administrator\Extension\ExampleComponent(
					$container-&gt;get(ComponentDispatcherFactoryInterface::class)
				);

				// PART 2.b: Set up the extension object
				$component-&gt;setMVCFactory($container-&gt;get(MVCFactoryInterface::class));

				// PART 2.c: return the extension object
				return $component;
			}
		);
	}
};
</pre><p>As you can see the service provider returns an <a class="link" href="https://www.php.net/manual/en/language.oop5.anonymous.php" target="_top">anonymous PHP class</a> which implements the <code class="code">Joomla\DI\ServiceProviderInterface</code>. That's the standard way to extend Joomla's DIC. Remember, as we learned in <a class="link" href="ch03s03.html" title="3.&nbsp;The lifetime of a component">the lifetime of a component</a>, Joomla creates a <span class="emphasis"><em>copy</em></span> of its DIC and uses it as our component's own DIC. The service providers we set up in our component stay with our component, they do not leak out to the global application scope (the global Joomla DIC you get through the <code class="code">Joomla\CMS\Factory::getContainer()</code> static method).</p><p>Part 1 of that file lets us register service providers to our component's DIC. At the bare minimum we need to register a <code class="code">Joomla\CMS\Extension\Service\Provider\MVCFactory</code> provider. This returns an object implementing <code class="code">Joomla\CMS\MVC\Factory\MVCFactoryInterface</code> which is used by our component's code (and Joomla's core code) to get the MVC objects of our component (Controllers, Models, Views, Tables). If we want to use more core Joomla features with out component we may have to register more service providers as we'll see in the <a class="link" href="ch03s06.html" title="6.&nbsp;Extension class">Extension class</a> section and the rest of the sections of this chapter.</p><p>Part 2 sets up a service provider returning an object implementing the <code class="code">Joomla\CMS\Extension\ComponentInterface</code>, i.e. our component's extension object.</p><p>Part 2.a is where we create an instance of our <a class="link" href="ch03s06.html" title="6.&nbsp;Extension class">extension class</a>. If you have a dead simple component which does not use a custom extension class you can use Joomla's built-in <code class="code">\Joomla\CMS\Extension\MVCComponent</code> class instead. Most components will need a custom extension class so we instantiate it here.</p><p>Part 2.b is where we set up the extension object we created in Part 2.a. Remember when I told you that <a class="link" href="ch02s02.html" title="2.&nbsp;Dependency Injection Container / Service Locator">Joomla's DIC is not really a Dependency Injection Container</a> but more of a Service Locator? Because of that fact, when we create the extension object it does not know of any service objects it needs to use. Therefore we have to push them manually.</p><p><span class="emphasis"><em>Sidebar: In my opinion, the three biggest shortcomings of the Joomla 4 MVC are the lack of convention over configuration, the lack of abstracted configuration and the lack of a real Dependency Injection container. These three shortcomings are, respectively, why we need to have a service provider file, why we need Part 1 and Part 2.b and why we need Part 2.a. Most other PHP frameworks have already solved these shortcomings. This means that any complaints that Joomla is moving to a very abstracted approach just to compete with other PHP frameworks are entirely unfounded; Joomla's architecture is still a good 10 or so years behind the PHP state of the art. This is not a bad thing! Too much abstraction may be a good thing for experienced, hardcore developers like yours truly but not necessarily the easiest thing to get your head around if you're a newcomer to Joomla or PHP in general.</em></span></p><p>Finally, we have Part 3 where we return the configured extension object, necessary for our custom service provider to <span class="emphasis"><em>actually work</em></span>.</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.svg"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>You may be tempted to think that the service provider is only ever called when Joomla is about to render your component. <span class="bold"><strong>This is not the case</strong></span>. Joomla will load a component's service provider any time it needs to interact with any of its services including the Router, or because another extension (such as a plugin, or module) wants to get access to your component's Models or some other service or object.</p><p>Just because your service provider's code is running DOES NOT mean you are about to render an HTML page with your component, it DOES NOT mean that you necessarily have access to the JPATH_COMPONENT and JPATH_COMPONENT_ADMINISTRATOR constants and absolutely DOES NOT mean that you should ever, <span class="emphasis"><em>ever</em></span>, try to push CSS, JavaScript or run any other code which assumes that Joomla is in an HTML output state.</p><p>If you have such code (which is generally a bad idea) you should run it in your component's <a class="link" href="ch03s07.html" title="7.&nbsp;Dispatcher">Dispatcher</a> and only after checking that you are indeed running in an HTML application (check the type of the object returned from calling <code class="code">\Joomla\CMS\Factory::getApplication()-&gt;getDocument()</code>).</p></td></tr></table></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s04.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch03.html"><img src="images/up.svg" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch03s06.html"><img src="images/next.svg" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">4.&nbsp;Directory structure&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.svg" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;6.&nbsp;Extension class</td></tr></table></div></body></html>