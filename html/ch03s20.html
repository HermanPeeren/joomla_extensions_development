<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>20.&nbsp;Passing data from the backend to the JavaScript on the page</title><link rel="stylesheet" type="text/css" href="html.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Joomla Extensions Development"><link rel="up" href="ch03.html" title="Chapter&nbsp;3.&nbsp;Components"><link rel="prev" href="ch03s19.html" title="19.&nbsp;Component menus"><link rel="next" href="ch03s21.html" title="21.&nbsp;Language files"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">20.&nbsp;Passing data from the backend to the JavaScript on the page</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s19.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Components</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch03s21.html"><img src="images/next.svg" alt="Next"></a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="com-data-to-frontend"></a>20.&nbsp;Passing data from the backend to the JavaScript on the page</h2></div></div></div><p>Back in the early Joomla 3 days we used to send data to the frontend JavaScript code using inline JavaScript fragments. For example:</p><pre class="programlisting">JFactory::getDocument()-&gt;addScriptDeclaration(&lt;&lt;&lt;JS
var comExampleSomething = "{$foobar}";
JS
);</pre><p>On the client side (JavaScript) you'd just use this JavaScript variable.</p><p>This is bad for a number of reasons. To begin with, the inline script declaration must definitely be parsed before any other code &#8212; including JavaScript files &#8212; which make use of it. Back when all scripts were loaded in the document's <code class="code">&lt;head&gt;</code> that was a given. However, this code broke spectacularly when met with any plugin or third party solution (such as CloudFlare RocketLoader) which moved the scripts at the bottom of the HTML <code class="code">&lt;body&gt;</code> or lazy-loaded them. There was no guaranteed script execution anymore.</p><p>The variable being passed (in our example, <code class="code">$foobar</code>) would have to be properly escaped to make it valid JavaScript or the client-side could break or, worse, we'd introduce a security vulnerability!</p><p>Moreover, this solution pollutes the JavaScript global scope and slows down the page as the browser has to stop parsing the DOM and rendering the page to evaluate the JavaScript.</p><p>Ever since Joomla 3.5 you had the option to instead push script options through the document:</p><pre class="programlisting">\Joomla\CMS\Factory::getDocument()-&gt;addScriptOptions(
  'com_example',
  [
    'foo' =&gt; $foobar,
    'bar' =&gt; SOME_CONSTANT,
  ]
);</pre><p>This embeds a JSON document into the HTML which does not need to be parsed by the browser as JavaScript. Instead, when the core JavaScript loads it will parse it and make it available to our client-side code:</p><pre class="programlisting">var comExampleOptions = Joomla.getOptions('com_example');
var distance = comExampleOptions.foo * comExampleOptions.bar;</pre><p>But how can we be sure that our code loads after the core Joomla JavaScript? Well, this is trivial in Joomla 4 and later by using the <a class="link" href="ch02s03.html" title="3.&nbsp;Web Asset Management">WebAssetManager</a> and adding <code class="code">core</code> as a dependency. We also need to set our script to have the option <code class="code">"defer": true</code> in our <code class="filename">joomla.asset.json</code> file so it loads deferred, i.e. after the browser parses the DOM &#8212; just like the core JavaScript does. This way we can be sure that our file executes after <code class="code">Joomla.getOptions</code> is available in JavaScript and we no longer need to add special code to execute our code after the page has finished loading; both conditions are guaranteed.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s19.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch03.html"><img src="images/up.svg" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch03s21.html"><img src="images/next.svg" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">19.&nbsp;Component menus&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.svg" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;21.&nbsp;Language files</td></tr></table></div></body></html>