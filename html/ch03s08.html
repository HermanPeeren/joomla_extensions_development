<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>8.&nbsp;Namespaces and MVC</title><link rel="stylesheet" type="text/css" href="html.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Joomla Extensions Development"><link rel="up" href="ch03.html" title="Chapter&nbsp;3.&nbsp;Components"><link rel="prev" href="ch03s07.html" title="7.&nbsp;Dispatcher"><link rel="next" href="ch03s09.html" title="9.&nbsp;The MVCFactory"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">8.&nbsp;Namespaces and MVC</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s07.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Components</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch03s09.html"><img src="images/next.svg" alt="Next"></a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="com-namespaces"></a>8.&nbsp;Namespaces and MVC</h2></div></div></div><p>Before we delve into the specifics of how Models, Views, Controllers and Tables work in the Joomla 4 MVC we need to talk about how they are <span class="emphasis"><em>named</em></span>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="com-namespaces-j3"></a>8.1.&nbsp;How things worked from Joomla 1.5 to 3.10</h3></div></div></div><p>In Joomla 3 the naming convention was <code class="code">ComponentTypeName</code> where</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="code">Component</code> is the name of the component without the <code class="code">com_</code> prefix and with the first letter in uppercase. For example, if you have <code class="code">com_example</code> the first part of an MVC class name was <code class="code">Example</code>.</p></li><li class="listitem"><p><code class="code">Type</code> is the type of the class you have, i.e. one of <code class="code">Component</code>, <code class="code">Model</code>, <code class="code">View</code>, or <code class="code">Table</code>. Again, the first letter is uppercase.</p></li><li class="listitem"><p>Name is the name of the specific MVC class with its first letter in uppercase, e.g. <code class="code">Item</code>.</p></li></ul></div><p>This conventions held true in both the front- and backend parts of your component. For example, both the frontend and the backend would have a class named ExampleControllerItem and they could not extend from each other. This led to a <span class="emphasis"><em>lot</em></span> of code duplication. Code duplication is the natural enemy of <a class="link" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" target="_top">DRY</a> (Don't Repeat Yourself) code and a source of the most egregious bugs. That's why this practice is mockingly called WET: Write Everything Twice. When you put it like that it sounds exactly as ridiculous as it is practicing it.</p><p>As for file naming, things were pretty clear for Controllers, Models and Tables. The name of the file was the <code class="code">Name</code> part of your class name, but in all lowercase. For example, the class <code class="code">ExampleControllerItem</code> was placed in a file called <code class="filename">item.php</code>.</p><p>Views were... a bit more complicated. A view has a <span class="emphasis"><em>view type</em></span> which corresponds to the <em class="parameter"><code>format</code></em> URL parameter, the default (if not specified) being <code class="option">html</code>. However, if all view classes of the <code class="code">com_example</code> component for the view name <code class="code">item</code> are called <code class="code">ExampleViewItem</code> how does Joomla figure out which one to load for the <code class="code">html</code>, <code class="code">json</code>, <code class="code">raw</code>, <code class="code">feed</code> etc view types? The trick was in the <span class="emphasis"><em>file name</em></span>. Regardless of the name of the view class, the file name the class was stored in was following the naming convention <code class="filename">view.<em class="replaceable"><code>view_type</code></em>.php</code> where the <em class="replaceable"><code>view_type</code></em> is the view type in all lowercase (corresponds to the URL <em class="parameter"><code>format</code></em> parameter). The HTML view class would be stored in a file called <code class="filename">view.html.php</code>. This was maddening because a. the file name does not include even a hint to the class name and b. view classes cannot extend from each other. Another case of WET.</p><p>With such complicated class and file naming &#8212; not to mention one not always being related to the other &#8212; it was impossible to write anything that remotely resembled a working autoloader for component classes. This resulted in Joomla using some ugly static calls in its base controller, model, view and table classes to get the MVC object you wanted. Whether that worked or not depended on whether they were called from within the same component or if you had used other badly documented static calls to tell these base classes where to look for component classes. If you wanted to mix front- and backend classes&#8230; let's just say the result was not pretty.</p><p>Basically, the Joomla 1.5 to 3.10 MVC class and file naming was a rolling Dumpster fire in the sixth ring of Hell. Yet, it was still better than nothing, i.e. what WordPress plugin developers have to contend with even to this day. It's funny how literally anything is better than nothing and how attached people got to what is objectively a bad solution which was rushed out of the door.</p><p>A bit of history: The MVC in Joomla 1.5 to 3.10 was never considered &#8220;finished&#8221; by its lead developer, Johan Janssens. He was aware of its shortcomings but ran out of time improving it in 2006. Janssens left the project shortly after Joomla 1.5 was released. The MVC architecture wasn't updated significantly in subsequent versions. Features were still added to it, e.g. Forms support in Joomla 1.6, but the class and file naming remained untouched until the release of Joomla 4 in 2020.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="com-namespaces-j4"></a>8.2.&nbsp;How things work Joomla 4.0 onwards</h3></div></div></div><p>Fixing the hot mess of class and file naming in component's MVC was one of the priorities in Joomla 4. Having a CMS in 2020 (when Joomla 4 was released) still use a half-finished and proven problematic architecture from 2006 would just not cut it.</p><p>The first step was to add <a class="link" href="ch02s01.html" title="1.&nbsp;Namespaces">namespaces</a> and make sure that the <a class="link" href="ch03s04.html" title="4.&nbsp;Directory structure">folder and file names</a> follow the <a class="link" href="https://www.php-fig.org/psr/psr-4/" target="_top">PSR-4</a> standard.</p><p>Your component's namespace prefix is declared in the XML manifest of the component using a new XML element under the <code class="code">&lt;extension&gt;</code> root element:</p><pre class="programlisting">&lt;namespace path="src"&gt;My\Namespace\Prefix&lt;/namespace&gt;</pre><p>The <code class="code">path</code> attribute tells Joomla which subdirectory of your extension holds the PSR-4 of your extension's PHP files. It is best practice to name it <code class="filename">src</code> but <span class="emphasis"><em>you don't have to</em></span>. I always assume you are using <code class="filename">src</code>.</p><p>The text inside the XML element, <code class="code">My\Namespace\Prefix</code> in our example, is the namespace prefix you will be using. Each component can register its own namespace prefix without any restrictions. It is <span class="emphasis"><em>recommended</em></span> to use the convention <code class="code">\Company\Something</code> where <code class="code">Company</code> is your company name (or a shortened version thereof) and <code class="code">Something</code> corresponds to the <code class="code">com_something</code> extension name of your component. For example, the component <code class="code">com_example</code> by Acme, Inc could have a namespace prefix of <code class="code">\Acme\Example</code> set up in its XML manifest.</p><p>Note that this is the common namespace prefix for your entire component. Your component has a different part for each of the three web applications in Joomla: frontend (site), backend (administrator) and api (the brand-new JSON API; this is optional).</p><p>Here is how namespace prefixes work across different types of extensions, assuming a common namespace prefix <code class="code">Acme\Example</code>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>Component, frontend</strong></span>. The frontend classes MUST be under the namespace <code class="code">\Acme\Example\Site</code>. The folder <code class="filename">components/com_example/src</code> is the root of the <code class="code">\Acme\Example\Site</code> namespace.</p></li><li class="listitem"><p><span class="bold"><strong>Component, backend</strong></span>. The backend classes MUST be under the namespace <code class="code">\Acme\Example\Administrator</code>. The folder <code class="filename">administrator/components/com_example/src</code> is the root of the <code class="code">\Acme\Example\Administrator</code> namespace.</p></li><li class="listitem"><p><span class="bold"><strong>Component, API application</strong></span>. The API application classes MUST be under the namespace <code class="code">\Acme\Example\Api</code>. The folder <code class="filename">api/components/com_example/src</code> is the root of the <code class="code">\Acme\Example\Api</code> namespace.</p></li></ul></div><p>As for the class naming, it's not a big departure from Joomla 3. It's just a more normalised version which takes namespaces into account.</p><p>In Joomla 4 and beyond the naming convention for controllers, models and tables is <code class="code">\<em class="replaceable"><code>NamespacePrefix</code></em>\<em class="replaceable"><code>ApplicationType</code></em>\<em class="replaceable"><code>Type</code></em>\<em class="replaceable"><code>Name</code></em><em class="replaceable"><code>Type</code></em></code> where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><em class="replaceable"><code>NamespacePrefix</code></em> is your common namespace prefix, e.g. <code class="code">\Acme\Example</code>.</p></li><li class="listitem"><p><em class="replaceable"><code>ApplicationType</code></em> is the type of the application part of your component i.e. one of <code class="code">Site</code> (frontend), <code class="code">Administrator</code> (backend), or <code class="code">Api</code> (JSON API application).</p></li><li class="listitem"><p><em class="replaceable"><code>Name</code></em> is the name of the specific MVC class with its first letter in uppercase, e.g. <code class="code">Item</code>.</p></li><li class="listitem"><p><code class="code"><em class="replaceable"><code>Type</code></em></code> is the type of the class you have, i.e. one of <code class="code">Component</code>, <code class="code">Model</code>, or <code class="code">Table</code>. Again, the first letter is uppercase.</p></li></ul></div><p>Controllers, models and tables are placed under your <code class="filename">src</code> directory following PSR-4. So, a backend class <code class="code">\Acme\Example\Administrator\Model\ItemModel</code> for a component <code class="code">com_example</code> whose common namespace prefix is <code class="code">\Acme\Example</code> is placed in the file <code class="filename">administrator/components/com_example/src/Model/ItemModel.php</code>.</p><p>Views have a very slightly different convention because we also have the <span class="emphasis"><em>view type</em></span>. Their naming convention is <code class="code">\<em class="replaceable"><code>NamespacePrefix</code></em>\<em class="replaceable"><code>ApplicationType</code></em>\View\<em class="replaceable"><code>Name</code></em>\<em class="replaceable"><code>ViewType</code></em></code> where:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><em class="replaceable"><code>NamespacePrefix</code></em> is your common namespace prefix, e.g. <code class="code">\Acme\Example</code>.</p></li><li class="listitem"><p><em class="replaceable"><code>ApplicationType</code></em> is the type of the application part of your component i.e. one of <code class="code">Site</code> (frontend), <code class="code">Administrator</code> (backend), or <code class="code">Api</code> (JSON API application).</p></li><li class="listitem"><p>Name is the name of the specific MVC class with its first letter in uppercase, e.g. <code class="code">Item</code>.</p></li><li class="listitem"><p><code class="code">ViewType</code> corresponds to the format URL parameter with its first letter in uppercase, e.g. <code class="code">Html</code>, <code class="code">Json</code>, <code class="code">Feed</code>, <code class="code">Raw</code> and so on.</p></li></ul></div><p>View classes are placed under your <code class="filename">src</code> directory following PSR-4. So, a backend class <code class="code">\Acme\Example\Administrator\View\Item\Html</code> for a component <code class="code">com_example</code> whose common namespace prefix is <code class="code">\Acme\Example</code> is placed in the file <code class="filename">administrator/components/com_example/src/View/Item/Html.php</code>.</p><p>Right away you can see how namespaces are benefiting us. A controller, model, or view in the frontend, backend and api application have a different FQN (<a class="link" href="https://www.php.net/manual/en/language.namespaces.rules.php" target="_top">Fully Qualified Name</a>). They no longer have the same name. One can extend the other if we want to, we <span class="emphasis"><em>can</em></span> mix front-, backend and api MVC objects if we need to and all of these classes can be autoloaded without having to use weird static calls. Cool!</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s07.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch03.html"><img src="images/up.svg" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch03s09.html"><img src="images/next.svg" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">7.&nbsp;Dispatcher&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.svg" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;9.&nbsp;The MVCFactory</td></tr></table></div></body></html>