<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>9.&nbsp;The MVCFactory</title><link rel="stylesheet" type="text/css" href="html.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Joomla Extensions Development"><link rel="up" href="ch03.html" title="Chapter&nbsp;3.&nbsp;Components"><link rel="prev" href="ch03s08.html" title="8.&nbsp;Namespaces and MVC"><link rel="next" href="ch03s10.html" title="10.&nbsp;Models"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">9.&nbsp;The MVCFactory</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s08.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Components</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch03s10.html"><img src="images/next.svg" alt="Next"></a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="com-mvcfactory"></a>9.&nbsp;The MVCFactory</h2></div></div></div><p>In Joomla 3 you had to make a static call to the base MVC class included in Joomla itself to get an instance of an MVC object. For example, getting your ExampleModelItem model object you had to do something like the following.</p><pre class="programlisting">$model = \Joomla\CMS\MVC\Model\BaseDatabaseModel::getInstance('Item', 'ExampleModel');</pre><p>If you were to do that in the frontend of the site you'd get the frontend <code class="code">ExampleModelItem</code> class stored in <code class="filename">components/com_example/models/item.php</code>. If you were to do that in the backend of the site you'd get the backend <code class="code">ExampleModelItem</code> class stored in <code class="filename">administrator/components/com_example/models/item.php</code>. If you did that from outside the <code class="code">com_example</code> component, e.g. in a module or plugin, it would fail unless either the class was already loaded beforehand OR you had done something like</p><pre class="programlisting">\Joomla\CMS\MVC\Model\BaseDatabaseModel::addIncludePath(
  'components/com_example/models', 'ExampleModel'
);</pre><p>Having to call a static method to get an object is bad architecture since the superclass where the static method lives in becomes a God Object &#8212; it knows way too much about how everything works in the entire CMS! Moreover, having the ability to auto-load classes only under certain circumstances, and having the object returned depend on both the application running under and magic configuration supplied by static method calls made it impossible to know what will be returned every time. The fact that backend and frontend classes had the exact same Fully Qualified Name made it impossible to double-check something didn't go awry. This loopy behaviour was a constant source of bugs.</p><p>Joomla 4 addressed this source of endless frustration by introducing the MVCFactory service in the <a class="link" href="ch02s02.html" title="2.&nbsp;Dependency Injection Container / Service Locator">component's DI container</a>. The MVCFactory object implements the <a class="link" href="https://en.wikipedia.org/wiki/Factory_method_pattern" target="_top">Factory method pattern</a> which means it can create instances of our MVC objects: controllers, models, views and tables.</p><div class="important"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.svg"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Each MVCFactory object instance can only create MVC objects for a <span class="bold"><strong>specific</strong></span> component! This is in stark contrast with the static calls in Joomla 3 which could create an MVC object for just about any component.</p><p>This is actually a good thing! It is implementing the fundamental computer science principle called <a class="link" href="https://en.wikipedia.org/wiki/Separation_of_concerns" target="_top">Separation of Concerns</a>. Put another way, if I get the MVCFactory object for <code class="code">com_example</code> I know that it can create any MVC object I need for <code class="code">com_example</code> and only that components. It won't be &#8220;polluted&#8221; by any other component. Every time I call an MVCFactory method <span class="bold"><strong>I AM 100% CONFIDENT</strong></span> I am getting the object I asked for and expected, not something potentially random I have no way of checking. Therefore, the MVCFactory object solves the single biggest source of frustration in Joomla component development. Hallelujah!</p></td></tr></table></div><p>When you are writing code in a Controller or Model class you can get your own component's MVCFactory instance using the <code class="code">$this-&gt;getMVCFactory()</code> method.</p><p>If you are outside a component &#8212; a module, plugin, template or a different component &#8212; you can <span class="emphasis"><em>still</em></span> get the MVCFactory of any installed and enabled component on the site as we saw in <a class="link" href="ch03s03.html" title="3.&nbsp;The lifetime of a component">the lifetime of a component</a>:</p><pre class="programlisting">$comContentMVCFactory = \Joomla\CMS\Factory::getApplication()
  -&gt;bootComponent('com_content')
  -&gt;getMVCFactory();</pre><div class="tip"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.svg"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Before trying to boot a component you are supposed to check the component is installed <span class="emphasis"><em>and</em></span> enabled. You can do that very simply, e.g. for <code class="code">com_content</code>, with this code</p><pre class="programlisting">\Joomla\CMS\Component\ComponentHelper::isEnabled('com_content')</pre></td></tr></table></div><p>The MVCFactory has four public methods corresponding to the MVC objects we can create:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">createController</span></dt><dd><p>Loads and creates a controller object.</p><pre class="programlisting">$myController = $this-&gt;getMVCFactory()
  -&gt;createController('Item', 'Administrator');</pre><p>The first argument is the name of the controller. The second argument is the application type (<code class="code">Site</code>, <code class="code">Administrator</code>, or <code class="code">Api</code>).</p></dd><dt><span class="term">createModel</span></dt><dd><p>Loads and creates a model object.</p><pre class="programlisting">$myModel = $this-&gt;getMVCFactory()
  -&gt;createModel('Item', 'Administrator');</pre><p>The first argument is the name of the controller. The second argument is the application type (<code class="code">Site</code>, <code class="code">Administrator</code>, or <code class="code">Api</code>).</p></dd><dt><span class="term">createView</span></dt><dd><p>Loads and creates a view object.</p><pre class="programlisting">$myView = $this-&gt;getMVCFactory()
  -&gt;createView('Item', 'Administrator', 'Html');</pre><p>The first argument is the name of the controller. The second argument is the application type (<code class="code">Site</code>, <code class="code">Administrator</code>, or <code class="code">Api</code>). The third argument is the view type which corresponds to the <em class="parameter"><code>format</code></em> URL parameter.</p></dd><dt><span class="term">createTable</span></dt><dd><p>Loads and creates a table object.</p><pre class="programlisting">$myTable = $this-&gt;getMVCFactory()
  -&gt;createTable('Item', 'Administrator');</pre><p>The first argument is the name of the controller. The second argument is the application type (<code class="code">Site</code>, <code class="code">Administrator</code>, or <code class="code">Api</code>).</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.svg"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Joomla table classes are only defined in the backend (<code class="code">Administrator</code>) of your component. Therefore your second argument MUST always be <code class="code">'Administrator'</code>.</p><p>While you could conceivably define table classes in the site or api parts of your component it's not recommended and you should not expect Joomla's core code to be able to find them. Think of that second argument as a &#8220;forwards compatibility&#8221; provision, in case Joomla ever fully supports creating tables in the site or api parts of your component.</p></td></tr></table></div></dd></dl></div><h3><a name="d0e2895"></a>MVCFactory and Dependency Injection</h3><p>The MVCFactory also performs a modicum of dependency injection. It inspects each created MVC object and checks which interfaces it implements. Depending on which interfaces are implemented some basic objects (form factory, dispatcher, router, cache controller, database object) are taken from the corresponding services in the component's DI container and injected into the MVC object.</p><p>If you want to inject additional services you will have to extend the MVCFactory service in your component's service provider using a custom MVCFactory wrapper. When registering the service extension in your component's <a class="link" href="ch03s05.html" title="5.&nbsp;Service provider">service provider</a> you can push your custom service to the MVCFactory wrapper and use it in the overridden methods of the wrapper. We will see an example of that <a class="link" href="ch03s10.html#com-models-push-service-joomla" title="10.2.&nbsp;Pushing services to the Model: the Joomla Way">pushing a custom service into a Model</a> later in this book.</p><p>While this sounds like a bit of a chore, it is actually a very clean architecture. If you decide to make a change in your service's initialisation &#8212; or swap it out with a completely different implementation altogether &#8212; you can do that trivially by changing one line of code in your service provider. No more hunting down all over your codebase for that elusive reference to the service you are using. This is just another way Dependency Injection helps you write more sustainable code.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s08.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch03.html"><img src="images/up.svg" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch03s10.html"><img src="images/next.svg" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">8.&nbsp;Namespaces and MVC&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.svg" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;10.&nbsp;Models</td></tr></table></div></body></html>