<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>17.&nbsp;Dashboard</title><link rel="stylesheet" type="text/css" href="html.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Joomla Extensions Development"><link rel="up" href="ch03.html" title="Chapter&nbsp;3.&nbsp;Components"><link rel="prev" href="ch03s16.html" title="16.&nbsp;Router"><link rel="next" href="ch03s18.html" title="18.&nbsp;The installation script"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">17.&nbsp;Dashboard</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s16.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Components</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch03s18.html"><img src="images/next.svg" alt="Next"></a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="com-dashboard"></a>17.&nbsp;Dashboard</h2></div></div></div><p>There is a new feature starting with Joomla 4: Dashboards.</p><p>Dashboards are sort of virtual pages, displayed by means of the com_cpanel core component, <a class="link" href="https://magazine.joomla.org/all-issues/april-2021/joomla-4-customising-admin-dashboards" target="_top">which allow the developer and the site owners to publish modules to customise them</a>.</p><h3><a name="d0e4913"></a>Define a dashboard</h3><p>You can define one or more dashboards in your component's XML manifest file:</p><pre class="programlisting">&lt;dashboards&gt;
  &lt;dashboard title="COM_EXAMPLE_DASHBOARD_TITLE" icon="none fa fa-beer"&gt;com_example.something&lt;/dashboard&gt;
&lt;/dashboards&gt;</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.svg"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p><code class="code">&lt;dashboards&gt;</code> is a top-level tag, directly under the <code class="code">&lt;extension&gt;</code> root tag. Yes, even though it only applies in the component's administration (backend) section. If your Dashboard does not work first check that you have not accidentally put that tag under <code class="code">&lt;administration&gt;</code>. It's the most common mistake!</p></td></tr></table></div><p>The <code class="code">title</code> attribute's value is a language string defined in your extension's backend INI language file. It's customary for its string to end with the word &#8220;Dashboard&#8221;, e.g.</p><pre class="programlisting">COM_EXAMPLE_DASHBOARD_TITLE="Example Dashboard"</pre><p>The value of the <code class="code">icon</code> attribute is a CSS class which gives the dashboard page its icon. Joomla 4 loads FontAwesome 5 Free so you can use <a class="link" href="https://fontawesome.com/v5/search?o=r&amp;m=free" target="_top">any of its icons</a>. Please remember that Joomla prefixes the value of the <code class="code">icon</code> attribute with the string literal <code class="code">icon-</code>. This does not let you use all FontAwesome icons. To work around that I use the value <code class="code">none fa fa-beer</code> which results in the HTML attribute and value <code class="code">class="icon-none fa fa-beer"</code>. Since <code class="code">icon-none</code> does not display anything, the browser falls back to the next two CSS classes which render FontAwesome's beer mug icon.</p><div class="warning"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.svg"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>The Dashboard is not part of your component. It does not load any custom backend CSS you may have. As a result, you cannot display your logo or any custom image in the Dashboard. While you could do that by loading custom CSS in a module you set up in the dashboard, do keep in mind that the user can easily disable (unpublish) that module and then your CSS won't load anymore. If you opt for this trick it's a good idea to provide a fallback to a Joomla system icon class or a FontAwesome icon class to make sure that <span class="emphasis"><em>something</em></span> is displayed as the Dashboard's title icon.</p></td></tr></table></div><p>The value inside the tag <span class="emphasis"><em>must</em></span> be in the format <code class="code">component.something</code> where component is the name of your component (e.g. <code class="code">com_example</code>) and something is a unique identifier for the dashboard among all dashboards defined in your component. For example, we could have the dashboard <code class="code">com_example.something</code>.</p><div class="important"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.svg"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Your component manifest MUST ALSO follow the naming convention <code class="filename">bareComponent.xml</code> and be placed in the backend folder of your component. For example, <code class="code">com_example</code>'s XML manifest MUST be called <code class="filename">example.xml</code> and be found in administrator/components/com_example/<code class="filename">example.xml</code>.</p><p>Keep in mind that Joomla automatically copies your component's XML manifest to the backend of your site when installing the component. You will only ever have to do it manually &#8212; if ever &#8212; when developing a component locally.</p></td></tr></table></div><p>The value of the tag after the dot is also important. All modules published to the module position <code class="code">cpanel-<em class="replaceable"><code>com_example</code></em>-<em class="replaceable"><code>something</code></em></code> will appear in this dashboard <code class="code">com_example.something</code>.</p><h3><a name="d0e5010"></a>Display a link to your dashboard in the component's submenu</h3><p>The dashboard is cool&#8230; but how do you even display it? As it turns out there are exactly two ways:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Put a link (e.g. a Toolbar link button) in your extension pointing the browser to <code class="uri">index.php?index.php?option=com_cpanel&amp;view=cpanel&amp;dashboard=<em class="replaceable"><code>com_example.something</code></em></code> where <em class="replaceable"><code>com_example.something</code></em> is your custom dashboard.</p></li><li class="listitem"><p>Add a submenu item in your XML manifest, e.g.</p><pre class="programlisting">&lt;menu&gt;COM_EXAMPLE&lt;/menu&gt;

&lt;submenu&gt;
  <span class="bold"><strong>&lt;menu
    link="index.php?option=com_cpanel&amp;amp;view=cpanel&amp;amp;dashboard=<em class="replaceable"><code>com_example.something</code></em>"&gt;
<em class="replaceable"><code>    COM_EXAMPLE_MENU_TITLE_DASHBOARD</code></em>
  &lt;/menu&gt;</strong></span>

  &lt;!-- more submenu items --&gt;
&lt;/submenu&gt;</pre><div class="important"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.svg"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Remember that the <em class="replaceable"><code>COM_EXAMPLE_MENU_TITLE_DASHBOARD</code></em> language string must be defined in your component's <code class="filename">.sys.ini</code> language file.</p></td></tr></table></div></li><li class="listitem"><p><span class="bold"><strong>Super ultra secret stuff!</strong></span> Tell Joomla to display a Dashboard link next to your component's top-level menu entry. In your XML manifest you need to modify your top level menu item like so:</p><pre class="programlisting">&lt;menu&gt;
  <span class="bold"><strong>&lt;params&gt;
    &lt;dashboard&gt;com_example.something&lt;/dashboard&gt;
  &lt;/params&gt;</strong></span>
  COM_EXAMPLE
&lt;/menu&gt;

&lt;submenu&gt;
  &lt;!-- your submenu items here&#8230; --&gt;
&lt;/submenu&gt;</pre><p>The contents of the <code class="code">params</code> menu subkey in the XML manifest goes through Joomla's Registry object and ends up, serialised as JSON, in the <span class="database">#__menu</span> table record's <span class="database">params</span> column. The <code class="code">dashboard</code> key tells Joomla to display a dashboard link next to the menu item's text. Its value tells Joomla <span class="emphasis"><em>which</em></span> dashboard to link to.</p></li></ul></div><p>It is actually a good idea using a combination of the methods above. The toolbar link can help lost users find their way back to the dashboard. While the <code class="code">params</code> trick is cool, it only works in the default components side menu. If the user has customised the menu, uses an alternative presentation or simply visits the Components Dashboard they won't see the link to your component's custom dashboard, therefore you may need the second method (the submenu link to your dashboard) to cater for these use cases. What can I say? Joomla is customisable. Maybe even a bit <span class="emphasis"><em>too</em></span> customisable.</p><h3><a name="d0e5084"></a>A custom menu preset for your dashboard</h3><p>You may have noticed that all core dashboards seem to have an &#8220;immutable&#8221; area at the top. This is not immutable; it's just a plain old module of the type <code class="code">mod_submenu</code> set to display in the module style <code class="code">none</code> (that's why you don't see the cogs button to edit it in the dashboard). You can of course edit this module like any other module in Content, Administrator Modules.</p><p>It's useful that we can also do the same for our own component and its dashboard. However, you may notice that mod_submenu only has presets for core components. What about our custom component? Well, as it turns out, there are no hardcoded presets! Everything you see available in mod_submenu is, in fact, file on your site and yes, we can do the same thing for our own component!</p><p>We need to create a custom menu preset for our component by creating an XML file under the <code class="filename">administrator/components/com_example/presets</code> folder. To get an idea of what you can do, take a look at a core preset such as <code class="filename">administrator/componetns/com_users/presets/users.xml</code>.</p><p>The name of your menu preset XML file MUST be unique across all components installed in Joomla. For this reason it's recommended to name it after your extension. For example, com_example's menu preset would be <code class="filename">administrator/components/com_example/presets/example.xml</code>.</p><p>If you need multiple presets in your component it's strongly recommended that their file names follow the pattern <code class="filename">component_something.xml</code>, e.g. <code class="filename">administrator/components/com_example/presets/example_alternate.xml</code>.</p><div class="tip"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.svg"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>Per-component menu presets can be overridden in the same way as view templates. For example, if you want to override the default core Users menu preset (<code class="filename">administrator/componetns/com_users/presets/users.xml</code>), copy it to <code class="filename">administrator/templates/atum/html/com_menus/presets/users.xml</code> and edit away!</p><p>Since all overrides live under the same <code class="filename">com_menus/presets</code> override folder you now understand why their name needs to be unique across all components installed on your site.</p></td></tr></table></div><p>Here is a sample preset, let's say it's <code class="filename">administrator/components/com_example/presets/example.xml</code> (this means the preset name is <code class="code">example</code>) .</p><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;menu
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="urn:joomla.org"
        xsi:schemaLocation="urn:joomla.org menu.xsd"
&gt;
    &lt;menuitem
            title="COM_EXAMPLE_MENUS_CONTENT"
            type="heading"
            icon="none fa-feather-alt"
    &gt;
        &lt;menuitem
                title="JCATEGORIES"
                type="component"
                element="com_categories"
                link="index.php?option=com_categories&amp;amp;view=categories&amp;amp;extension=com_example"
                quicktask="index.php?option=com_categories&amp;amp;extension=com_example&amp;amp;task=category.add"
                quicktask-title="COM_EXAMPLE_MENUS_NEW_CATEGORY"
        /&gt;

        &lt;menuitem
                title="COM_EXAMPLE_MENUS_ITEMS"
                type="component"
                element="com_example"
                link="index.php?option=com_example&amp;amp;view=items"
                quicktask="index.php?option=com_example&amp;amp;task=item.add"
                quicktask-title="COM_EXAMPLE_MENUS_NEW_ITEM"
        /&gt;
    &lt;/menuitem&gt;
&lt;/menu&gt;</pre><p>Here are some <span class="bold"><strong>practical</strong></span> tips:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The icon attribute sets the CSS class for the heading by combining the literal string <code class="code">icon-</code> with the value of the attribute. The number of icons available that way is minuscule compared to the plethora of icons available in FontAwesome 5 Free. This is why I use values for this attribute in the form <code class="code">none fa-something</code>. This results in the CSS class being set to <code class="code">icon-none fa-something</code>. There is no such thing as an <code class="code">icon-none</code> CSS class, so that part does nothing. The next part, the <code class="code">fa-something</code>, is where I tell the browser to use one of the available FontAwesome icons.</p></li><li class="listitem"><p>The <code class="code">quicktask</code> and <code class="code">quicktask-title</code> attributes set up the little quick action icon next to the menu item text. By default, this is a plus icon, implying that you can add an item. You can customise that icon using the attribute <code class="code">menu-quicktask-icon</code> which works in the exact same way as a heading's <code class="code">icon</code> attribute.</p><p>Why would you want to customise it? Well, let's say you have a security component with a view called Automatically Blocked IP Addresses. It would not make sense to manually add a new entry &#8212; since they are <span class="emphasis"><em>automatically</em></span> blocked &#8212; but it would totally make sense to have a quick action to <span class="emphasis"><em>unblock</em></span> an accidentally blocked IP address. In this case a more appropriate icon would be <code class="code">fa-unlock</code>.</p></li></ul></div><h3><a name="d0e5191"></a>Creating and publishing the custom dashboard menu module, automatically</h3><p>All right. We have a dashboard. We have a menu item to access it. We have a custom menu to display in a mod_submenu module inside the dashboard. But how exactly do we get to create this kind of module? We can't possibly ask our users to create it manually, that would suck!</p><p>The answer is that Joomla gives us ALMOST everything we need to create that module in our component's installation script.</p><p>First, let's make sure our component does use an installation script. In the XML manifest we need to add a line like this, as we're familiar from Joomla 3:</p><pre class="programlisting">&lt;scriptfile&gt;script.example.php&lt;/scriptfile&gt;</pre><p>The <code class="code">script.example.php</code> will contain our component installation script. You are familiar with that; it's been around since Joomla 1.0.</p><p>What you may not have picked up is that since Joomla 3.6 there's a superclass our installation script can extend from. In Joomla 3 it was called <code class="classname">JInstallerScript</code>, in Joomla 4 it's <code class="classname">Joomla\CMS\Installer\InstallerScript</code> (the old name will work up to and including Joomla 5.3). We'll get into more detail on it <a class="link" href="ch03s18.html" title="18.&nbsp;The installation script">in the installation script section</a>.</p><p>Joomla's InstallerScript provides a handy method called <code class="methodname">addDashboardMenu</code> which creates a <code class="code">mod_submenu</code> module to a specific dashboard using a specific menu preset. However, the way it is written it assumes that it will only ever be executed once, the first time you install a component. What about hundreds of third party components which have been around long before Joomla 4? Don't worry, we have a solution! We will install the module if and only if it's missing, regardless of whether this is a new installation or an update.</p><p>Here's how to do that:</p><pre class="programlisting">&lt;?php
defined('_JEXEC') || die;

use Joomla\CMS\Factory;
use Joomla\CMS\Installer\Adapter\PackageAdapter;
use Joomla\CMS\Installer\InstallerScript;

class <span class="bold"><strong>Com_ExampleInstallerScript</strong></span> extends InstallerScript
{
	/**
	 * Called after any type of installation / uninstallation action.
	 *
	 * @param   string          $type    Which action is happening (install|uninstall|discover_install|update)
	 * @param   PackageAdapter  $parent  The object responsible for running this script
	 *
	 * @return  bool
	 * @since   1.0.0
	 */
	public function postflight(string $type, PackageAdapter $parent): bool
	{
		// Do not run on uninstall.
		if ($type === 'uninstall')
		{
			return true;
		}

		// Install the dashboard module if necessary
		$this-&gt;conditionalInstallDashboard(<span class="bold"><strong>'com-example-example', 'example'</strong></span>);

		return true;
	}

	private function conditionalInstallDashboard(string $dashboard, string $preset): void
	{
		$position = 'cpanel-' . $dashboard;

		/** @var \Joomla\Database\DatabaseDriver $db */
		$db = Factory::getContainer()-&gt;get('DatabaseDriver');
		$query = $db-&gt;getQuery(true)
		            -&gt;select('COUNT(*)')
		            -&gt;from($db-&gt;quoteName('#__modules'))
		            -&gt;where([
			            $db-&gt;quoteName('module') . ' = ' . $db-&gt;quote('mod_submenu'),
			            $db-&gt;quoteName('client_id') . ' = ' . $db-&gt;quote(1),
			            $db-&gt;quoteName('position') . ' = :position',
		            ])
		            -&gt;bind(':position', $position);

		$modules = $db-&gt;setQuery($query)-&gt;loadResult() ?: 0;

		if ($modules == 0)
		{
			$this-&gt;addDashboardMenu($dashboard, $preset);
		}
	}

}</pre><p>The <code class="methodname">postflight</code> method is called whenever Joomla has finished trying to install <span class="emphasis"><em>or uninstall</em></span> (in Joomla 3 it was only after installation!) our component and before it cleans up. At this point we can check if there is a module already installed. If not, we let Joomla's code install it.</p><p>The only two things you need to change above are the parts in bold type: the class name to match your component's name and the parameters to the <code class="methodname">conditionalInstallDashboard</code> method. The parameters are fairly obvious: the name of the dashboard (replacing the underscore and dot with a dash!) and the name of your menu preset which typically is the same as your component's name without the <code class="code">com_</code> prefix.</p><div class="tip"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.svg"></td><th align="left"></th></tr><tr><td align="left" valign="top"><p>You can publish modules to your Dashboards by assigning them to a module position named something like <code class="code">cpanel-com-<em class="replaceable"><code>example</code></em>-<em class="replaceable"><code>something</code></em></code> where <em class="replaceable"><code>example</code></em> is the name of your component without <code class="code">com_</code> and <em class="replaceable"><code>something</code></em> is the name of your custom dashboard without the component prefix. The aforementioned example module corresponds to the dashboard <code class="code">com_example.something</code>.</p><p>Likewise, Quick Icon modules can be assigned to a custom dashboard by publishing them to the module position <code class="code">icon-com-<em class="replaceable"><code>example</code></em>-<em class="replaceable"><code>something</code></em></code> following the same convention as above (you just replace <code class="code">cpanel</code> with <code class="code">icon</code>). Remember that Quick Icon modules are displayed <span class="emphasis"><em>above</em></span> the other dashboard modules.</p></td></tr></table></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s16.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch03.html"><img src="images/up.svg" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch03s18.html"><img src="images/next.svg" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">16.&nbsp;Router&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.svg" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;18.&nbsp;The installation script</td></tr></table></div></body></html>