<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>15.&nbsp;Categories</title><link rel="stylesheet" type="text/css" href="html.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Joomla Extensions Development"><link rel="up" href="ch03.html" title="Chapter&nbsp;3.&nbsp;Components"><link rel="prev" href="ch03s14.html" title="14.&nbsp;HTML helper service"><link rel="next" href="ch03s16.html" title="16.&nbsp;Router"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">15.&nbsp;Categories</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s14.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Components</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch03s16.html"><img src="images/next.svg" alt="Next"></a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="com-categories"></a>15.&nbsp;Categories</h2></div></div></div><p>Sometimes your components may need to use Joomla's Categories feature. I am not talking about using content categories, where articles are placed in. I am talking about having Joomla manage categories for your own items. This is what Joomla itself is doing for its core components like Contacts and Banners.</p><p>Using Joomla's categories instead of inventing your own categorisation has many benefits. The obvious benefit is that users are exposed to a familiar and consistent category management interface. Beyond the obvious, this is the only way you can have nice things such as <a class="link" href="ch03s26.html" title="26.&nbsp;Custom fields">integration with custom fields</a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="com-categories-db"></a>15.1.&nbsp;Database schema changes</h3></div></div></div><p>Your table which contains the <span class="emphasis"><em>items</em></span> which go into each category needs to have a few columns:</p><pre class="programlisting">`id`          BIGINT(20)    NOT NULL AUTO_INCREMENT COMMENT 'Item unique ID',
`catid`       BIGINT(20)    NOT NULL COMMENT 'Category ID',
`state`       TINYINT(3)    NOT NULL DEFAULT '1' COMMENT 'Publish status',</pre><p>These fields don't necessarily need to have these names; we can change them in the code. However, these column names are the default used in Joomla and it makes it easier for you to follow third party tutorials and for other people to follow what you are doing with your code.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="com-categories-manifest"></a>15.2.&nbsp;Changes to your XML manifest and forms</h3></div></div></div><p>A lot of this integration is, in fact, smoke and mirrors. Users are taken to the core <code class="code">com_categories</code> component to manage categories. <code class="code">com_categories</code> uses a form in our component, in the file <code class="filename">administrator/components/<em class="replaceable"><code>com_example</code></em>/forms/category.xml</code> where <em class="replaceable"><code>com_example</code></em> is our component, to add sections to the category configuration beyond the standard Joomla stuff. The way Joomla's main menu works along with a small change in our XML manifest will make the user think they are still in our component while they are using Joomla's com_categories.</p><p>For the user to have a way to manage categories and maintain the illusion they remain in our extension you have to add the following code in your XML manifest under &lt;extension&gt;, &lt;administration&gt;, &lt;submenu&gt;:</p><pre class="programlisting">&lt;menu link="option=com_categories&amp;amp;extension=<em class="replaceable"><code>com_example</code></em>"&gt;JCATEGORIES&lt;/menu&gt;</pre><p>where <em class="replaceable"><code>com_example</code></em> is the name of your component.</p><p>By default, you'll get a rather barren category edit page with just the bare minimum of information Joomla needs to store about a category (a title, alias and description are required &#8212; you can't hide them or remove them in any way). The basic tabs you get in the category editor are Category, Options, Publishing, Fields (if any custom Fields are set up for the category) and Permissions.</p><p>You can display additional tabs with component-specific configuration options by creating the file <code class="filename">administrator/components/<em class="replaceable"><code>com_example</code></em>/forms/category.xml</code> where <em class="replaceable"><code>com_example</code></em> is the name of your component. This is a regular Joomla XML form file. Just remember, every <code class="code">&lt;fieldset&gt;</code> you add becomes a tab in the Category edit page. Neat, huh?</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="com-categories-service"></a>15.3.&nbsp;The Category service</h3></div></div></div><p>Categories are great and all, but if you need to get their parameters or create SEF routes for nested categories you need to somehow get information on categories. This is what the category service does for us.</p><p>It is customary &#8212; or at least I have not found a concrete reason to not be able to do otherwise &#8212; that the Category Service is created in the <span class="emphasis"><em>frontend</em></span> part of your site.</p><p>Assuming our <code class="code">com_example</code> component with the namespace prefix <code class="code">Acme\Example</code>, you need to create the class <code class="classname">Acme\Example\Site\Service\Category</code> in the file <code class="filename">components/com_example/src/Service/Category.php</code> like this:</p><pre class="programlisting">&lt;?php

namespace Acme\Example\Site\Service;

defined('_JEXEC') or die;

use Joomla\CMS\Categories\Categories;

class Category extends Categories
{
	public function __construct($options)
	{
		$options = array_merge($options, [
			'extension'  =&gt; 'com_example',
			'table'      =&gt; '#__example_items',
			'field'      =&gt; 'catid',
			'key'        =&gt; 'id',
			'statefield' =&gt; 'state',
		]);

		parent::__construct($options);
	}

}</pre><p>The array in the <code class="methodname">__construct</code> method is all you need to customise and it's fairly self-explanatory.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">extension</span></dt><dd><p>The name of your component e.g. <code class="code">com_example</code>.</p></dd><dt><span class="term">table</span></dt><dd><p>The name of the table holding the category <span class="emphasis"><em>items</em></span>. As customary in Joomla you use <span class="database">#__</span> to denote the common table name prefix.</p></dd><dt><span class="term">field</span></dt><dd><p>The name of the database column which contains the numeric category ID. The default is <code class="code">catid</code>.</p></dd><dt><span class="term">key</span></dt><dd><p>The name of the database column which contains the item's primary key. The default is <code class="code">id</code>.</p></dd><dt><span class="term">statefield</span></dt><dd><p>The name of the database column which contains the item's publish state. The default is <code class="code">state</code>.</p></dd></dl></div><p>Now you see why I told you to use the database table field names customarily used by Joomla; they minimise the code you need to write down to two array keys: <code class="code">extension</code> and <code class="code">table</code>.</p><p>Unlike other services provided by your component, the category service is instantiated directly:</p><pre class="programlisting">$catService = new Acme\Example\Site\Service\Category([]);</pre><p>The array in the constructor arguments is not just for show. It can help you narrow down the list of categories to be returned with the following keys:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">access</span></dt><dd><p>Boolean. When true, Joomla will only return the categories visible to the current user. It does that by only getting from the database the categories whole <span class="database">access</span> field is one of the Joomla viewing access levels the current user has access to.</p></dd><dt><span class="term">published</span></dt><dd><p>Integer 0 or 1. When it's 1 it will only return categories which are published. When 0 it will return published, unpublished <span class="emphasis"><em>and trashed</em></span> categories.</p></dd><dt><span class="term">countItems</span></dt><dd><p>Integer 0 or 1. Note the weird capitalisation in the middle of this key's name! When it's 1, Joomla will return the number of items contained in each category at the expense of performance. Use this sparingly and only when you absolutely need it e.g. when displaying paginated views.</p></dd></dl></div><p>Also keep in mind that Joomla tries to be smart. A bit <span class="emphasis"><em>too</em></span> smart, maybe. When you are on a multilingual site it will only return categories whose language is either the currently selected language or &#8220;All&#8221; (denoted by a <code class="code">*</code> in the language column of the <span class="database">#__categories</span> table). If you want to override this behaviour you will need to change your Categories Service constructor like so:</p><pre class="programlisting">	public function __construct($options)
	{
		$options = array_merge($options, [
			'extension'  =&gt; 'com_example',
			'table'      =&gt; '#__example_items',
			'field'      =&gt; 'catid',
			'key'        =&gt; 'id',
			'statefield' =&gt; 'state',
		]);

		parent::__construct($options);

		$this-&gt;_options['currentlang'] = $options['currentlang'] ?? $this-&gt;_options['currentlang'];
	}</pre><p>If you want the instance of the Categories Service to return all categories regardless of the current language in a multilingual site you can now do:</p><pre class="programlisting">$catService = new Acme\Example\Site\Service\Category([
  'currentlang' =&gt; 0
]);</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s14.html"><img src="images/prev.svg" alt="Prev"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch03.html"><img src="images/up.svg" alt="Up"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch03s16.html"><img src="images/next.svg" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">14.&nbsp;HTML helper service&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.svg" alt="Home"></a></td><td width="40%" align="right" valign="top">&nbsp;16.&nbsp;Router</td></tr></table></div></body></html>